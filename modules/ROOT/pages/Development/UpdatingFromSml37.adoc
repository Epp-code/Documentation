= Upgrading from SML 3.7.0 to 3.8.x

[NOTE]
====
This page is still a work in progress.

If you have any feedback, please let us know in the Discord.
====

TODO

- update the regular modding guides to use the new Alpakit UI and mention game version stuff (partially done)
- Update generic updating guide to have a step for bumping game and SML version
- update uplugin fields page with GameVersion dep

[IMPORTANT]
====
The contents of this page will change frequently!
Keep your eyes on the `#modding-info-feed` discord channel to be notified when updates are made.
====

SML3.8 brings support for the game's 1.0 release, as well as a few new toys and fixes to long-running bugs.

Because of the game's engine update, mods compiled for SML3.7 will not work with SML3.8.

First, please _read this entire page before you begin updating your mod_.
It will save you time later to have an idea going in of what to expect while updating.

After you have finished reading this page,
follow the directions on the
xref:Development/UpdatingToNewVersions.adoc[Updating your Mod]
guide to install the updated engine, starter project, and update your mod.

== New Features

=== Session Setting Replication

SML correctly handles Session Setting replication to multiplayer clients now.
Thanks SirDigby and Mircea for implementing this.

=== SML Capable of Running Client-Side Only

It is now possible have SML installed on your client even when the server does not have SML installed.
This means you can create client-side mods that work when connected to vanilla servers.
An example of a mod that implements this functionality is https://ficsit.app/mod/InfiniteNudge[Infinite Nudge].

Of course, a mod installed only on the client will be incapable of many things that normal dual-sided mods can accomplish
due to game implementation details.

Note that the inverse (joining a server with SML from a vanilla client) is not yet possible.

=== Content Tag Registry

SML now offers a registry to assist mods with using
https://dev.epicgames.com/documentation/en-us/unreal-engine/using-gameplay-tags-in-unreal-engine?application_version=5.3[Unreal Gameplay Tags].

Gameplay Tags are a useful way to introduce some cross-mod compatibility without hard dependencies on other mods.

Read the xref:Development/ModLoader/ContentTagRegistry.adoc[Content Tag Registry] page for more information.

[id="SMLNoLongerHardRequired"]
=== Mods No Longer Require a Dependency on SML

Although 99% of mods should still depend on SML for its feature set,
Ficsit.app now supports uploading mods without an SML dependency.
If you think your mod is part of the 1%,
read more on the xref:Development/Satisfactory/ModsWithoutSML.adoc[Modding Without SML] page.

== Not Done Yet

The following features are not quite ready to use yet.
This section will change often, so be sure to come back here and check as you update your mods!

=== 'New Game' Menu Customizations

SML's changes to the New Game menu were broken by its 1.0 rework.
This affects any mod that introduced new Levels
and the ability to configure xref:Development/ModLoader/SessionSettings.adoc[Session Settings] before world creation.
This will be fixed before SML 3.8's public release.

=== Can't Join Dedicated Servers

Trying to join a dedicated server with SML installed will currently always crash the client
with an error related to null RCO when calling RequestAllSessionSettings from ASessionSettingsSubsystem::Init.
This will be fixed before SML 3.8's public release.

=== Content Registry Issue with Mod Schematics Depending on Vanilla Schematics

See https://github.com/satisfactorymodding/SatisfactoryModLoader/issues/248[this github issue for more info].
This should not affect the vast majority of mods.

=== Modded AWESOME Shop Schematics Do Not Load on Clients

See https://github.com/satisfactorymodding/SatisfactoryModLoader/issues/277[this github issue for more info].

=== Advanced Game Settings values not saved

The xref:Development/ModLoader/SessionSettings.adoc[Session Settings] page
explains how you can create your own Advanced Game Settings.
However, their values are not currently saved with the save file.
Session Settings still function correctly - their values are saved.

== Required Changes

In addition to any specific-to-your-mod issues you may encounter,
the changes described below _must_ be made in order for your mod to be updated.

=== Dependency Updates

The following project dependencies have updated.
Install the updated versions as you follow the xref:Development/UpdatingToNewVersions.adoc[Updating your Mod] guide.

==== Engine Update

Satisfactory 1.0 brings the game to Unreal Engine 5.3.
Download and set up our custom release while following the
xref:Development/UpdatingToNewVersions.adoc[Updating your Mod guide].

==== Wwise Update

With a new Unreal Engine version comes a new required Wwise update for your project.
The xref:Development/BeginnersGuide/dependencies.adoc#_wwise[Dependencies page Wwise instructions]
lists the new Wwise version and guides you through integrating it into your project as you follow the
xref:Development/UpdatingToNewVersions.adoc[Updating your Mod guide].

==== CLang Toolchain Update

Working with the updated Unreal Engine version requires an updated CLang toolchain.
Insalling it is covered in the
xref:Development/BeginnersGuide/dependencies.adoc#ClangToolchain[Dependencies page CLang Toolchain instructions].

=== Understanding New Game Targets

The 1.0 release has introduced new Windows build targets -
`FactoryGameSteam` and `FactoryGameEGS` -
to allow Coffee Stain to ship different versions of the game for Steam and Epic Games.
This enables them to provide the Epic Games overlay connection on the Steam version, for example.
There should be very few game code differences between these two targets.

Alpakit has been updated to support these new targets without you having to worry about it.

- When building {cpp} for the editor, use `Development Editor - FactoryGame`
- When building {cpp} for shipping outside of the editor, use either `FactoryGameSteam` or `FactoryGameEGS` depending on what you are testing with.
- ‚ùå Don't try to build `Shipping - FactoryGame` or `FactoryShared` - they aren't released targets; trying to build them will always error.
- When running Alpakit Development or Alpakit Release, Alpakit will build both targets as one for you; the pre-1.0 workflow is unaffected.

=== Alpakit Changes

Understanding the changes to Alpakit, and the new features added in this update, will help you work efficiently.

==== Alpakit Dev and Alpakit Release Split into Separate Windows

The Alpakit Release functionality (for creating release builds) has been brought into its own window to help with UI readability
and understanding which Alpakit settings are relevant to development time.

You can open the new Alpakit windows via these buttons in Unreal Editor's toolbar or the File dropdown menu.

image:Development/UpdatingGuides/AlpakitButtons38.png[Screenshot of new Alpakit buttons]

==== Launch Game Type: Custom Split into Path and Arguments

If you were previously using, for example,
`powershell.exe C:/Git/SF_ModProject/RobWorkingDir/SFLaunch_Advanced.ps1 -branch EXP -loadLatestSave`
you should now use:

* Custom Path: `powershell`
* Custom Launch Args: `C:/Git/SF_ModProject/RobWorkingDir/SFLaunch_Advanced.ps1 -branch EXP -loadLatestSave`

==== New Alpakit Log Feature: Time Since Last Pack

The Alpakit Log now displays the time a last successful pack was completed.
Great for if you started packing something, went to do something else, and came back but can't remember what exactly you started!

[id="Alpakit_GameVersionDependency"]
== Game Version Dependency

Ficsit.app now requires uploaded mods to specify a minimum game version with which the mod is compatible.
The reasoning behind this is explained in link:#SMLNoLongerHardRequired[this section].

Alpakit will warn you in the Alpakit Release window if your mod's game version is older than the project's game version.
Clicking on this warning will automatically update the field for you.

SML will check this game version at runtime,
requiring that the player's game version is greater than or equal to the listed required version.

== Additional Changes

You might not be affected by these changes,
but we'd like to draw extra attention to them.

=== Add Tags to Relevant Content in your Mod

If your mod adds any item descriptors that serves a special non-crafting purpose,
like the Any Undefined, Wildcard, Overflow, and None sorting rule in the base game,
use the xref:Development/ModLoader/ContentTagRegistry.adoc[Content Tag Registry]
to add the `SML.Registry.Item.SpecialItemDescriptor` tag to it.
See that page for more information.

You may also wish to tag your mod's content with the generic tags that SML implements.

=== Funchook Improvements

We have switched to our own custom build of Funchook to (hopefully) avoid the
https://github.com/satisfactorymodding/SatisfactoryModLoader/issues/235[rare inconsistent hooking crash issue].
If your mod makes use of hooking (and especially unhooking), watch for any bugs that may arise related to this
and let us know on the discord if you encounter any issues.

=== Starter Project Structure page

The new xref:Development/BeginnersGuide/StarterProjectStructure.adoc[Starter Project Structure]
documentation page explains important Starter Project folders and the Placeholder System in more detail.

=== Decal_Normal FIXED on Modded Parts using Mesh Proxies

Previous versions of the game had issues with mesh proxies past the first instance not rendering correctly.
Ben says 1.0 has a fix for this issue, but no modders have tested it yet.
This section will be updated when we have confirmation.
